\documentclass[aspectratio=169]{beamer}
\usepackage{polski}
\usepackage{xltxtra}
\usepackage{listings}
\usepackage{xcolor}
\usepackage{siunitx}
\usepackage{graphicx}

\usetheme{Singapore}

\title{Copy and paste rules --- why functions?}
\author{Adam GÅ‚owacki}
\date{April 8th, 2022}
\beamertemplatenavigationsymbolsempty

\definecolor{keywordColor}{HTML}{AF5F00}
\definecolor{commentColor}{HTML}{12488B}
\definecolor{stringColor}{HTML}{C01C28}
\newcommand{\style}[1]{\ttfamily#1}
\lstset{
  showstringspaces=false,
  basicstyle=\style{\normalsize},
  commentstyle=\color{commentColor}\textit,
  keywordstyle=\color{keywordColor}\bfseries,
  stringstyle=\color{stringColor},
  language=python
}

\begin{document}

\begin{frame}
\titlepage
\end{frame}

\section{Staff database}

\begin{frame}[fragile]
\frametitle{123456.txt}
\begin{verbatim}
Alice Green
Principal Office Assistant
Warsaw, Aleje Jerozolimskie
8900
...
\end{verbatim}
\end{frame}

\begin{frame}
\frametitle{Update the files}
\begin{enumerate}
  \item 123313: 11\% salary raise
  \item 123790: moved to Polarna street in Katowice
  \item 123856: 10\% salary raise
\end{enumerate}
\end{frame}

\begin{frame}
\frametitle{What to do}
For each person/file:
\begin{itemize}
  \item read the file contents
  \item find the right line
  \item replace the piece of information
  \item update the file contents
\end{itemize}
\end{frame}

\begin{frame}[fragile]
\begin{lstlisting}
f = open('123313.txt', 'r')
lines = f.read().splitlines()
f.close()

f = open('123313.txt', 'w')
f.write('\n'.join(lines))
f.close()
\end{lstlisting}
\end{frame}

\begin{frame}[fragile]
\begin{columns}
\begin{column}{0.5\textwidth}
\begin{verbatim}
Alice Green
Principal Office Assistant
Warsaw, Aleje Jerozolimskie
8900
...
\end{verbatim}
\end{column}
\begin{column}{0.5\textwidth}
\begin{lstlisting}
f = open('123313.txt', 'r')
lines = f.read().splitlines()
f.close()

old_salary = int(lines[3])
new_salary = 1.11 * old_salary
lines[3] = str(new_salary)

f = open('123313.txt', 'w')
f.write('\n'.join(lines))
f.close()
\end{lstlisting}
\end{column}
\end{columns}
\end{frame}

\begin{frame}[fragile]
\begin{lstlisting}
f = open('123790.txt', 'r')
lines = f.read().splitlines()
f.close()

lines[2] = 'Katowice, Polarna'

f = open('123313.txt', 'w')
f.write('\n'.join(lines))
f.close()
\end{lstlisting}
\end{frame}

\begin{frame}[fragile]
\begin{columns}
\begin{column}{0.5\textwidth}
\begin{lstlisting}[basicstyle=\style{\tiny}]
f = open('123313.txt', 'r')
lines = f.read().splitlines()
f.close()

old_salary = int(lines[3])
new_salary = 1.11 * old_salary
lines[3] = str(new_salary)

f = open('123313.txt', 'w')
f.write('\n'.join(lines))
f.close()

f = open('123790.txt', 'r')
lines = f.read().splitlines()
f.close()

lines[2] = 'Katowice, Polarna'

f = open('123790.txt', 'w')
f.write('\n'.join(lines))
f.close()

f = open('123856.txt', 'r')
lines = f.read().splitlines()
f.close()

old_salary = int(lines[3])
new_salary = 1.10 * old_salary
lines[3] = str(new_salary)

f = open('123856.txt', 'w')
f.write('\n'.join(lines))
f.close()
\end{lstlisting}
\end{column}
\begin{column}{0.5\textwidth}
\end{column}
\end{columns}
\end{frame}

\begin{frame}[fragile]
\begin{columns}
\begin{column}{0.5\textwidth}
\begin{lstlisting}[basicstyle=\style{\tiny}]
f = open('123313.txt', 'r')
lines = f.read().splitlines()
f.close()

old_salary = int(lines[3])
new_salary = 1.11 * old_salary
lines[3] = str(new_salary)

f = open('123313.txt', 'w')
f.write('\n'.join(lines))
f.close()

f = open('123790.txt', 'r')
lines = f.read().splitlines()
f.close()

lines[2] = 'Katowice, Polarna'

f = open('123790.txt', 'w')
f.write('\n'.join(lines))
f.close()

f = open('123856.txt', 'r')
lines = f.read().splitlines()
f.close()

old_salary = int(lines[3])
new_salary = 1.10 * old_salary
lines[3] = str(new_salary)

f = open('123856.txt', 'w')
f.write('\n'.join(lines))
f.close()
\end{lstlisting}
\end{column}
\begin{column}{0.5\textwidth}
Similar task
\begin{itemize}
  \item 697123: 12\% salary raise
  \item 112001: 33\% salary raise
\end{itemize}
\end{column}
\end{columns}
\end{frame}

\begin{frame}[fragile]
\begin{columns}
\begin{column}{0.5\textwidth}
\begin{lstlisting}[basicstyle=\style{\tiny}]
f = open('123313.txt', 'r')
lines = f.read().splitlines()
f.close()

old_salary = int(lines[3])
new_salary = 1.11 * old_salary
lines[3] = str(new_salary)

f = open('123313.txt', 'w')
f.write('\n'.join(lines))
f.close()

# ---

f = open('123790.txt', 'r')
lines = f.read().splitlines()
f.close()

lines[2] = 'Katowice, Polarna'

f = open('123790.txt', 'w')
f.write('\n'.join(lines))
f.close()
\end{lstlisting}
\end{column}
\begin{column}{0.5\textwidth}
\begin{lstlisting}[basicstyle=\style{\tiny}]
# ---

f = open('123856.txt', 'r')
lines = f.read().splitlines()
f.close()

old_salary = int(lines[3])
new_salary = 1.10 * old_salary
lines[3] = str(new_salary)

f = open('123856.txt', 'w')
f.write('\n'.join(lines))
f.close()
\end{lstlisting}
\end{column}
\end{columns}
\end{frame}

\begin{frame}[fragile,label=longcode]
\begin{columns}
\begin{column}{0.5\textwidth}
\begin{lstlisting}[basicstyle=\style{\tiny}]
# READ FILE
f = open('123313.txt', 'r')
lines = f.read().splitlines()
f.close()

# CHANGE SALARY
old_salary = int(lines[3])
new_salary = 1.11 * old_salary
lines[3] = str(new_salary)

# WRITE FILE
f = open('123313.txt', 'w')
f.write('\n'.join(lines))
f.close()

# ---

# READ FILE
f = open('123790.txt', 'r')
lines = f.read().splitlines()
f.close()

# CHANGE ADDRESS
lines[2] = 'Katowice, Polarna'

# WRITE FILE
f = open('123790.txt', 'w')
f.write('\n'.join(lines))
f.close()
\end{lstlisting}
\end{column}
\begin{column}{0.5\textwidth}
\begin{lstlisting}[basicstyle=\style{\tiny}]
# ---

# READ FILE
f = open('123856.txt', 'r')
lines = f.read().splitlines()
f.close()

# CHANGE SALARY
old_salary = int(lines[3])
new_salary = 1.10 * old_salary
lines[3] = str(new_salary)

# WRITE FILE
f = open('123856.txt', 'w')
f.write('\n'.join(lines))
f.close()
\end{lstlisting}
\end{column}
\end{columns}
\end{frame}

\section{Functions}

\begin{frame}
\centering
\Huge
Function
\end{frame}

\begin{frame}
\centering
\Huge
$f(x) = x + 1$
\end{frame}

\begin{frame}
\centering
\Huge
$f(x) = x + 1$

$g(x) = 2x - x + 1$

$h(x) = \frac{42 + x^2\cdot{}x}{x^3+42} - x + 1$
\end{frame}

\begin{frame}[fragile]
\begin{columns}
\begin{column}{0.5\textwidth}
\LARGE
$f(x) = x + 1$
\end{column}
\begin{column}{0.5\textwidth}
\begin{lstlisting}[basicstyle=\style{\LARGE}]
def f(x):
  return x + 1
\end{lstlisting}
\end{column}
\end{columns}
\end{frame}

\begin{frame}[fragile]
\begin{lstlisting}[basicstyle=\style{\large}]
def f(x):
  print("Hi, how are you?")
  return x + 1
\end{lstlisting}
\end{frame}

\begin{frame}[fragile]
\begin{lstlisting}[basicstyle=\style{\large}]
def f(x, y):
  print("Hi, how are you?")
  return x - y + 1
\end{lstlisting}
\end{frame}

\begin{frame}[fragile]
\begin{lstlisting}[basicstyle=\style{\large}]
def f():
  print("Hi, how are you?")
\end{lstlisting}
\end{frame}

\section{Use functions}

\begin{frame}[fragile]
\begin{lstlisting}[basicstyle=\style{\small}]
# READ FILE
f = open('123856.txt', 'r')
lines = f.read().splitlines()
f.close()
\end{lstlisting}
\vspace{1.5cm}
\begin{lstlisting}[basicstyle=\style{\small}]
def read_file(person):
  f = open(person + '.txt', 'r')
  lines = f.read().splitlines()
  f.close()
\end{lstlisting}
\end{frame}

\begin{frame}[fragile]
\begin{lstlisting}[basicstyle=\style{\small}]
# READ FILE
f = open('123856.txt', 'r')
lines = f.read().splitlines()
f.close()
\end{lstlisting}
\vspace{1.5cm}
\begin{lstlisting}[basicstyle=\style{\small}]
def read_file(person):
  f = open(person + '.txt', 'r')
  lines = f.read().splitlines()
  f.close()
  return lines
\end{lstlisting}
\end{frame}

\begin{frame}[fragile]
\begin{lstlisting}[basicstyle=\style{\small}]
# CHANGE SALARY
old_salary = int(lines[3])
new_salary = 1.10 * old_salary
lines[3] = str(new_salary)
\end{lstlisting}
\vspace{1.5cm}
\begin{lstlisting}[basicstyle=\style{\small}]
def change_salary(lines, x):
  old_salary = int(lines[3])
  new_salary = x * old_salary
  lines[3] = str(new_salary)
\end{lstlisting}
\end{frame}

\begin{frame}[fragile]
\begin{lstlisting}[basicstyle=\style{\small}]
# CHANGE ADDRESS
lines[2] = 'Katowice, Polarna'
\end{lstlisting}
\vspace{1.5cm}
\begin{lstlisting}[basicstyle=\style{\small}]
def change_address(lines, new_address):
  lines[2] = new_address
\end{lstlisting}
\end{frame}

\begin{frame}[fragile]
\begin{lstlisting}[basicstyle=\style{\small}]
# WRITE FILE
f = open('123313.txt', 'w')
f.write('\n'.join(lines))
f.close()
\end{lstlisting}
\vspace{1.5cm}
\begin{lstlisting}[basicstyle=\style{\small}]
def write_file(person, lines):
  f = open(person + '.txt', 'w')
  f.write('\n'.join(lines))
  f.close()
\end{lstlisting}
\end{frame}

\againframe{longcode}

\begin{frame}[fragile]
\begin{columns}
\begin{column}{0.5\textwidth}
\begin{lstlisting}[basicstyle=\style{\tiny}]
# READ FILE
lines = read_file('123313')

# CHANGE SALARY
change_salary(lines, 1.11)

# WRITE FILE
write_file('123313', lines)

# ---

# READ FILE
lines = read_file('123790')

# CHANGE ADDRESS
change_address(lines, 'Katowice, Polarna')

# WRITE FILE
write_file('123790', lines)
\end{lstlisting}
\end{column}
\begin{column}{0.5\textwidth}
\begin{lstlisting}[basicstyle=\style{\tiny}]

# ---

# READ FILE
lines = read_file('123856')

# CHANGE SALARY
change_salary(lines, 1.10)

# WRITE FILE
write_file('123856', lines)
\end{lstlisting}
\end{column}
\end{columns}
\end{frame}

\begin{frame}[fragile]
\begin{lstlisting}
lines = read_file('123313')
change_salary(lines, 1.11)
write_file('123313', lines)

lines = read_file('123790')
change_address(lines, 'Katowice, Polarna')
write_file('123790', lines)

lines = read_file('123856')
change_salary(lines, 1.10)
write_file('123856', lines)
\end{lstlisting}
\end{frame}

\begin{frame}[fragile]
Function call/return costs resources!
\pause
\begin{columns}
\begin{column}{0.5\textwidth}
\begin{lstlisting}[basicstyle=\style{\small}]
def f(x):
  return 2 * x + 3 * x + 1
\end{lstlisting}
\end{column}

\begin{column}{0.5\textwidth}
\begin{lstlisting}[basicstyle=\style{\small}]
def twice(x):
  return 2 * x

def thrice(x):
  return 3 * x

def g(x):
  return twice(x) + thrice(x) + 1
\end{lstlisting}

\end{column}
\end{columns}
\pause
\SI{0.18}{\us} vs \SI{0.32}{\us} ($1.8\times$)
\end{frame}

\begin{frame}[fragile]
\begin{columns}
\begin{column}{0.5\textwidth}
\begin{lstlisting}[basicstyle=\style{\tiny}]
def fib(i):
  if i == 0 or i == 1:
    return 1
  else:
    return fib(i-1) + fib(i-2)

print(fib(40))
\end{lstlisting}
\end{column}
\begin{column}{0.5\textwidth}
\begin{lstlisting}[basicstyle=\style{\tiny},language=C]
#include <stdio.h>

int fib(int i) {
  if (i == 0 || i == 1)
    return 1;
  else
    return fib(i-1) + fib(i-2);
}

int main(void) {
  printf("%u\n", fib(40));
  return 0;
}
\end{lstlisting}
\end{column}
\end{columns}
\pause
\SI{37}{\s} vs \SI{0.1}{\s} ($370\times$)
\end{frame}

\section{Pure or impure}

\begin{frame}
\centering
\Huge
Pure vs ``dirty'' functions
\end{frame}

\begin{frame}[fragile]
\begin{lstlisting}
def payEmployee(employeeId, hours):
  connectionId = 12332

  today = datetime.date.today()
  weekday = today.isoweekday() # 1 for Monday, 7 for Sunday

  if weekday == 7:
    r = paySundayTime(connectionId, employeeId, hours)
  else:
    r = payNormalTime(connectionId, employeeId, hours)
  return r
\end{lstlisting}
\end{frame}

\begin{frame}[fragile]
\begin{lstlisting}
def payEmployee(employeeId, hours, today):
  connectionId = 12332

  weekday = today.isoweekday() # 1 for Monday, 7 for Sunday

  if weekday == 7:
    r = paySundayTime(connectionId, employeeId, hours)
  else:
    r = payNormalTime(connectionId, employeeId, hours)
  return r
\end{lstlisting}
\end{frame}

\begin{frame}[fragile]
\begin{lstlisting}
# def payEmployee(employeeId, hours, today)

r1 = payEmployee(1434, 8, datetime.date(2022, 4, 1))
r2 = payEmployee(1434, 8, datetime.date(2022, 4, 2))
r3 = payEmployee(1434, 8, datetime.date(2022, 4, 3))
r4 = payEmployee(1434, 8, datetime.date(2022, 4, 4))
\end{lstlisting}
\end{frame}

\begin{frame}
Why would anybody need a program that doesn't interact with him?
\end{frame}

\section{Script as a function}

\begin{frame}[fragile]
\begin{lstlisting}
import sys

print("I was called with those arguments:")
print(sys.argv)
sys.exit(24)
\end{lstlisting}
\vspace{1.5cm}
\begin{lstlisting}[language=sh]
> python args.py 123 445 9080
I was called with those arguments:
['args.py', '123', '445', '9080']

> echo %errorlevel%
24
\end{lstlisting}
\end{frame}

\section{Homework}

\begin{frame}[fragile]
\frametitle{``Clean up'' the code using functions}
\begin{lstlisting}[basicstyle=\style{\fontsize{4}{4}\selectfont{}}]
import sys

# the first element in 'sys.argv' (at index 0) is always the script file name;
# therefore look for the numbers starting with the second element (index 1)
if len(sys.argv) == 2:
    arg1 = int(sys.argv[1])
    if arg1 < 0:
        print("Sorry, expected non-negative integers")
        sys.exit(1) # end with 1 to indicate error
    result = arg1 + 42 - 4
    print("Result of the function is: ", result)
elif len(sys.argv) == 3:
    arg1 = int(sys.argv[1])
    if arg1 < 0:
        print("Sorry, expected non-negative integers")
        sys.exit(1) # end with 1 to indicate error
    arg2 = int(sys.argv[2])
    if arg2 < 0:
        print("Sorry, expected non-negative integers")
        sys.exit(1) # end with 1 to indicate error
    result = arg1 + arg2 - 4
    print("Result of the function is: ", result)
elif len(sys.argv) == 4:
    arg1 = int(sys.argv[1])
    if arg1 < 0:
        print("Sorry, expected non-negative integers")
        sys.exit(1) # end with 1 to indicate error
    arg2 = int(sys.argv[2])
    if arg2 < 0:
        print("Sorry, expected non-negative integers")
        sys.exit(1) # end with 1 to indicate error # end with 1 to indicate error
    arg3 = int(sys.argv[3])
    if arg3 < 0:
        print("Sorry, expected non-negative integers")
        sys.exit(1) # end with 1 to indicate error
    result = arg1 + arg2 - arg3
    print("Result of the function is: ", result)
else:
    print("Invalid arguments - expected 1..3 non-negative integer numbers")
    sys.exit(1) # end with 1 to indicate error
\end{lstlisting}

\end{frame}

\end{document}
